"""
CIFå‘å°„æœºåˆ¶æ·±åº¦è§£æï¼šä¸ºä»€ä¹ˆåœ¨ç¬¬tå¸§å‘å°„æ˜¯åˆç†çš„ï¼Ÿ
è§£ç­”æ ¸å¿ƒç–‘é—®ï¼šç¬¬tå¸§çš„encoderè¾“å‡ºçœŸçš„èƒ½ä»£è¡¨ä¸€ä¸ªå®Œæ•´tokenå—ï¼Ÿ
"""

import torch
import torch.nn as nn
import numpy as np
import matplotlib.pyplot as plt


# ===================== é—®é¢˜é™ˆè¿° =====================

def state_the_problem():
    """é™ˆè¿°é—®é¢˜"""
    print("=" * 80)
    print("æ ¸å¿ƒé—®é¢˜ï¼šCIFå‘å°„æœºåˆ¶çš„åˆç†æ€§")
    print("=" * 80)
    
    problem = """
    é—®é¢˜æè¿°ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    åœ¨CIFä¸­ï¼Œå½“ç´¯ç§¯çš„alphaå€¼è¾¾åˆ°é˜ˆå€¼1.0æ—¶ï¼Œå°±åœ¨å½“å‰æ—¶åˆ»tå‘å°„ä¸€ä¸ªtokenï¼š
    
    ```python
    for t in range(enc_len):
        integrated += alphas[:, t]
        if integrated >= 1.0:
            features = encoder_output[:, t, :]  # å°±ç”¨ç¬¬tå¸§çš„ç‰¹å¾ï¼
            sampled_features.append(features)
            integrated -= 1.0
    ```
    
    ç–‘é—®ï¼š
    â“ ç¬¬tå¸§çš„encoder_outputçœŸçš„èƒ½ä»£è¡¨ä¸€ä¸ªå®Œæ•´tokenå—ï¼Ÿ
    â“ å¦‚æœç¬¬tå¸§å¯¹åº”çš„æ˜¯é™éŸ³/å™ªå£°/blankï¼Œä¸æ˜¯å¾ˆå¥‡æ€ªå—ï¼Ÿ
    â“ ä¸ºä»€ä¹ˆä¸ç”¨å‰é¢å‡ å¸§çš„åŠ æƒå¹³å‡ï¼Œè€Œæ˜¯ç›´æ¥ç”¨ç¬¬tå¸§ï¼Ÿ
    
    è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ¶‰åŠåˆ°å¯¹CIFæœºåˆ¶æ›´æ·±å±‚çš„ç†è§£ï¼
    """
    print(problem)


# ===================== ç­”æ¡ˆ1ï¼šAlphaçš„çœŸå®å«ä¹‰ =====================

def answer_1_alpha_meaning():
    """Alphaä¸æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯ç»è¿‡è®­ç»ƒå­¦ä¼šçš„"""
    print("\n" + "=" * 80)
    print("ç­”æ¡ˆ1ï¼šAlphaæ˜¯è®­ç»ƒå‡ºæ¥çš„ï¼Œä¸æ˜¯éšæœºçš„")
    print("=" * 80)
    
    explanation = """
    å…³é”®ç†è§£ï¼šAlphaä¸ä¼šè®©blankå¸§å‘å°„tokenï¼
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. Alphaçš„è®­ç»ƒç›‘ç£
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    è®­ç»ƒæ—¶æœ‰ä¸¤ä¸ªå…³é”®çº¦æŸï¼š
    
    çº¦æŸ1: Alphaæ€»å’Œ = ç›®æ ‡é•¿åº¦
        Loss_alpha = |Î£Î± - N|Â²
        å…¶ä¸­Næ˜¯çœŸå®æ–‡æœ¬çš„tokenæ•°é‡
    
    çº¦æŸ2: CTC Lossç¡®ä¿å¯¹é½æ­£ç¡®
        æ¨¡å‹å¿…é¡»æ­£ç¡®è¯†åˆ«æ¯ä¸ªtokenï¼Œè¿™è¦æ±‚ï¼š
        - æœ‰ä¿¡æ¯çš„å¸§ï¼šÎ± > 0
        - æ— ä¿¡æ¯çš„å¸§ï¼šÎ± â‰ˆ 0
    
    2. è®­ç»ƒåAlphaçš„è¡Œä¸ºæ¨¡å¼
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ç»è¿‡è®­ç»ƒï¼Œæ¨¡å‹å­¦ä¼šï¼š
    
    âœ“ åœ¨tokençš„"ç»“æŸä½ç½®"ç»™é«˜alpha
    âœ“ åœ¨tokençš„"å¼€å§‹ä½ç½®"ç»™ä½alpha
    âœ“ åœ¨é™éŸ³/blankå¸§ç»™æ¥è¿‘0çš„alpha
    
    ç¤ºä¾‹ï¼šè¯†åˆ«"ä½ å¥½"
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å¸§:   0    1    2    3    4    5    6    7    8    9
    éŸ³:   [é™éŸ³] [n-ä½ -i]      [h-å¥½-ao]     [é™éŸ³]
    Î±:   0.0  0.2  0.3  0.5  0.1  0.3  0.4  0.3  0.0  0.0
    ç´¯ç§¯: 0.0  0.2  0.5  1.0  0.1  0.4  0.8  1.1  0.1  0.1
                         â†‘å‘å°„            â†‘å‘å°„
                      å¸§3="ä½ "          å¸§7="å¥½"
    
    ä¸ºä»€ä¹ˆåœ¨å¸§3å’Œå¸§7å‘å°„ï¼Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - å¸§3: ç´¯ç§¯åˆ°1.0ï¼Œæ­¤æ—¶"ä½ "çš„å‘éŸ³å³å°†ç»“æŸï¼Œå¸§3åŒ…å«äº†"ä½ "çš„å®Œæ•´ä¿¡æ¯
    - å¸§7: ç´¯ç§¯åˆ°1.1ï¼Œæ­¤æ—¶"å¥½"çš„å‘éŸ³å³å°†ç»“æŸï¼Œå¸§7åŒ…å«äº†"å¥½"çš„å®Œæ•´ä¿¡æ¯
    
    å…³é”®ï¼šä¸æ˜¯"æ°å¥½åœ¨blankå‘å°„"ï¼Œè€Œæ˜¯"åœ¨tokenç»“æŸæ—¶å‘å°„"ï¼
    """
    print(explanation)
    
    # å¯è§†åŒ–
    print("\n" + "â”€" * 80)
    print("å¯è§†åŒ–ï¼šAlphaå¦‚ä½•é¿å…åœ¨blankå¸§å‘å°„")
    print("â”€" * 80)
    
    visualization = """
    é”™è¯¯çš„Alphaåˆ†å¸ƒï¼ˆæœªè®­ç»ƒå¥½ï¼‰ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å¸§:    0    1    2    3    4    5    6    7    8
    éŸ³ç´ :  é™   n    i    blank h    a    o    é™   é™
    Î±:    0.5  0.5  0.5  0.5  0.5  0.5  0.5  0.5  0.5  âŒ
    ç´¯ç§¯:  0.5  1.0  0.5  1.0  0.5  1.0  0.5  1.0  0.5
              â†‘       â†‘       â†‘       â†‘
           åœ¨blankå‘å°„ï¼ä¼šå‡ºé”™ï¼
    
    æ­£ç¡®çš„Alphaåˆ†å¸ƒï¼ˆè®­ç»ƒå¥½ï¼‰ï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å¸§:    0    1    2    3    4    5    6    7    8
    éŸ³ç´ :  é™   n    i    blank h    a    o    é™   é™
    Î±:    0.0  0.3  0.7  0.0  0.2  0.4  0.4  0.0  0.0  âœ“
    ç´¯ç§¯:  0.0  0.3  1.0  0.0  0.2  0.6  1.0  0.0  0.0
                  â†‘                   â†‘
              å¸§2å‘å°„"ä½ "          å¸§6å‘å°„"å¥½"
              (åœ¨"i"ç»“æŸä½ç½®)      (åœ¨"o"ç»“æŸä½ç½®)
    
    ä¸ºä»€ä¹ˆè®­ç»ƒåçš„Alphaæ˜¯æ­£ç¡®çš„ï¼Ÿ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å› ä¸ºCTC Lossä¼šæƒ©ç½šé”™è¯¯çš„å¯¹é½ï¼
    
    å¦‚æœåœ¨blankå¸§å‘å°„ï¼š
    - CTCä¼šå‘ç°å¯¹é½ä¸å¯¹
    - åå‘ä¼ æ’­è°ƒæ•´Alpha
    - æœ€ç»ˆAlphaå­¦ä¼šåœ¨æ­£ç¡®ä½ç½®å‘å°„
    """
    print(visualization)


# ===================== ç­”æ¡ˆ2ï¼šEncoderçš„å»ºæ¨¡èƒ½åŠ› =====================

def answer_2_encoder_modeling():
    """Encoderæœ‰ä¸Šä¸‹æ–‡å»ºæ¨¡èƒ½åŠ›"""
    print("\n" + "=" * 80)
    print("ç­”æ¡ˆ2ï¼šEncoderè¾“å‡ºä¸æ˜¯å±€éƒ¨ç‰¹å¾ï¼Œè€Œæ˜¯å…¨å±€ä¸Šä¸‹æ–‡è¡¨ç¤º")
    print("=" * 80)
    
    explanation = """
    å…³é”®ç†è§£ï¼šEncoder_output[t]ä¸åªåŒ…å«ç¬¬tå¸§çš„ä¿¡æ¯ï¼
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. Transformer/Conformerçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ```python
    # ç®€åŒ–çš„Self-Attention
    for t in range(T):
        encoder_output[t] = Attention(
            query = frame[t],
            key = frame[0:T],      # çœ‹åˆ°æ‰€æœ‰å¸§ï¼
            value = frame[0:T]     # èšåˆæ‰€æœ‰å¸§ï¼
        )
    ```
    
    è¿™æ„å‘³ç€ï¼š
    âœ“ encoder_output[t] èšåˆäº†å‰åæ‰€æœ‰å¸§çš„ä¿¡æ¯
    âœ“ å³ä½¿ç¬¬tå¸§æœ¬èº«æ˜¯blankï¼Œencoder_output[t]ä»åŒ…å«å‘¨å›´æœ‰ç”¨ä¿¡æ¯
    
    2. å®é™…ä¾‹å­
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å‡è®¾è¯†åˆ«"ä½ "è¿™ä¸ªå­—ï¼š
    
    åŸå§‹éŸ³é¢‘å¸§:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    t=0: [é™éŸ³ç‰¹å¾]      â†’ æ²¡ä»€ä¹ˆä¿¡æ¯
    t=1: [nçš„èµ·å§‹]       â†’ æœ‰ä¸€ç‚¹ä¿¡æ¯
    t=2: [nçš„æŒç»­]       â†’ ä¿¡æ¯å¢åŠ 
    t=3: [içš„å¼€å§‹]       â†’ ä¸»è¦ä¿¡æ¯
    t=4: [içš„ç»“æŸ]       â†’ å®Œæ•´ä¿¡æ¯
    
    Encoderè¾“å‡º (ç»è¿‡Self-Attention):
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    encoder_output[0]: èšåˆäº† t=0,1,2,3,4 çš„ä¿¡æ¯ â†’ åŒ…å«"ä½ "çš„å®Œæ•´ä¿¡æ¯
    encoder_output[1]: èšåˆäº† t=0,1,2,3,4 çš„ä¿¡æ¯ â†’ åŒ…å«"ä½ "çš„å®Œæ•´ä¿¡æ¯  
    encoder_output[2]: èšåˆäº† t=0,1,2,3,4 çš„ä¿¡æ¯ â†’ åŒ…å«"ä½ "çš„å®Œæ•´ä¿¡æ¯
    encoder_output[3]: èšåˆäº† t=0,1,2,3,4 çš„ä¿¡æ¯ â†’ åŒ…å«"ä½ "çš„å®Œæ•´ä¿¡æ¯
    encoder_output[4]: èšåˆäº† t=0,1,2,3,4 çš„ä¿¡æ¯ â†’ åŒ…å«"ä½ "çš„å®Œæ•´ä¿¡æ¯ âœ“
    
    æ‰€ä»¥å½“åœ¨t=4å‘å°„æ—¶ï¼š
    - è™½ç„¶åªå–encoder_output[4]
    - ä½†å®ƒå®é™…åŒ…å«äº†æ•´ä¸ª"ä½ "çš„ä¿¡æ¯ï¼ˆé€šè¿‡attentionèšåˆï¼‰
    - å®Œå…¨å¯ä»¥ä»£è¡¨"ä½ "è¿™ä¸ªtokenï¼
    
    3. å—é™æ„Ÿå—é‡ (Causal Attention)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å¦‚æœä½¿ç”¨å› æœæ³¨æ„åŠ›ï¼ˆåªçœ‹è¿‡å»ï¼‰ï¼š
    
    encoder_output[t] = Attention(
        query = frame[t],
        key = frame[0:t+1],    # åªçœ‹åˆ°è¿‡å»çš„å¸§
        value = frame[0:t+1]
    )
    
    åœ¨è¿™ç§æƒ…å†µä¸‹ï¼š
    - encoder_output[t] åŒ…å«äº†ä»0åˆ°tçš„æ‰€æœ‰ä¿¡æ¯
    - å½“ç´¯ç§¯åˆ°t=4è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè¯´æ˜ä»0åˆ°4çš„ä¿¡æ¯è¶³ä»¥è¡¨ç¤ºä¸€ä¸ªtoken
    - encoder_output[4] å°±æ˜¯è¿™äº›ä¿¡æ¯çš„æ€»ç»“
    
    4. æ•°å­¦ç›´è§‰
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    å¯ä»¥è¿™æ ·ç†è§£CIFçš„å‘å°„ï¼š
    
    ä¼ ç»Ÿæ–¹æ³•:
        token_feature = Î£ weight[i] * frame[i]  (åŠ æƒå¹³å‡å¤šå¸§)
    
    CIFæ–¹æ³•:
        token_feature = encoder_output[t]
        å…¶ä¸­ encoder_output[t] å·²ç»é€šè¿‡attentionåšäº†åŠ æƒå¹³å‡ï¼
        
    æ‰€ä»¥CIFå¹¶æ²¡æœ‰"åªç”¨å•å¸§"ï¼Œè€Œæ˜¯ç”¨äº†"å·²ç»èšåˆè¿‡çš„å•å¸§"ï¼
    """
    print(explanation)


# ===================== ç­”æ¡ˆ3ï¼šæ›´ç²¾ç¡®çš„CIFå˜ä½“ =====================

def answer_3_cif_variants():
    """ä»‹ç»è§£å†³è¿™ä¸ªé—®é¢˜çš„CIFæ”¹è¿›ç‰ˆæœ¬"""
    print("\n" + "=" * 80)
    print("ç­”æ¡ˆ3ï¼šCIFçš„æ”¹è¿›ç‰ˆæœ¬ - è§£å†³æ½œåœ¨é—®é¢˜")
    print("=" * 80)
    
    explanation = """
    è™½ç„¶æ ‡å‡†CIFå·²ç»workå¾—å¾ˆå¥½ï¼Œä½†ç¡®å®æœ‰æ”¹è¿›ç©ºé—´
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    æ”¹è¿›1: Weighted CIF (åŠ æƒCIF)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ä¸åªç”¨ç¬¬tå¸§ï¼Œè€Œæ˜¯ç”¨ç´¯ç§¯è¿‡ç¨‹ä¸­çš„åŠ æƒå’Œ
    
    æ ‡å‡†CIF:
    ```python
    if integrated >= 1.0:
        features = encoder_output[:, t, :]  # åªç”¨ç¬¬tå¸§
    ```
    
    Weighted CIF:
    ```python
    accumulated_features = 0
    for t in range(enc_len):
        # æŒ‰alphaæƒé‡ç´¯ç§¯ç‰¹å¾
        accumulated_features += alphas[:, t] * encoder_output[:, t, :]
        
        if integrated >= 1.0:
            # ä½¿ç”¨ç´¯ç§¯çš„åŠ æƒç‰¹å¾
            features = accumulated_features / integrated
            sampled_features.append(features)
            accumulated_features = 0  # é‡ç½®
    ```
    
    ä¼˜åŠ¿ï¼š
    âœ“ æ˜¾å¼åœ°å¯¹å¤šå¸§åŠ æƒå¹³å‡
    âœ“ ç†è®ºä¸Šæ›´åˆç†
    
    å®é™…æ•ˆæœï¼š
    âš ï¸ æ•ˆæœæå‡ä¸æ˜æ˜¾ï¼ˆ< 0.1% WERï¼‰
    âš ï¸ è®¡ç®—å¼€é”€å¢åŠ 
    âš ï¸ æ ‡å‡†CIFå·²ç»é€šè¿‡attentionéšå¼åšäº†åŠ æƒ
    
    
    æ”¹è¿›2: Soft CIF (è½¯CIF)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ä¸æ˜¯hardåœ°åœ¨æŸä¸ªæ—¶åˆ»å‘å°„ï¼Œè€Œæ˜¯softåœ°ç»„åˆ
    
    ```python
    # è®¡ç®—æ¯å¸§å¯¹æ¯ä¸ªtokençš„è´¡çŒ®
    contribution[i, t] = how much frame t contributes to token i
    
    # è½¯ç»„åˆ
    token_feature[i] = Î£ contribution[i, t] * encoder_output[t]
    ```
    
    ä¼˜åŠ¿ï¼š
    âœ“ å¯å¾®åˆ†æ€§æ›´å¥½
    âœ“ é¿å…ç¡¬å†³ç­–
    
    
    æ”¹è¿›3: Boundary-aware CIF
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    è®­ç»ƒAlphaæ—¶å¢åŠ è¾¹ç•Œçº¦æŸ
    
    ```python
    # é™¤äº†Alpha sum lossï¼Œè¿˜åŠ å…¥è¾¹ç•Œæ­£åˆ™åŒ–
    Loss_boundary = penalize_firing_at_blank_frames()
    ```
    
    ä¼˜åŠ¿ï¼š
    âœ“ æ˜¾å¼é¿å…åœ¨blankå¸§å‘å°„
    
    å®é™…ï¼š
    âš ï¸ æ ‡å‡†è®­ç»ƒå·²ç»éšå¼å­¦ä¼šè¿™ä¸ª
    
    
    æ”¹è¿›4: Multi-scale CIF
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    åœ¨å¤šä¸ªæ—¶é—´å°ºåº¦ä¸ŠåšCIF
    
    ```python
    # ç²—ç²’åº¦: è¯†åˆ«è¯
    coarse_tokens = CIF(encoder_output, alpha_coarse)
    
    # ç»†ç²’åº¦: è¯†åˆ«å­—ç¬¦
    fine_tokens = CIF(encoder_output, alpha_fine)
    
    # ç»„åˆ
    final_output = combine(coarse_tokens, fine_tokens)
    ```
    
    ä¼˜åŠ¿ï¼š
    âœ“ æ›´é²æ£’
    âœ“ å¯ä»¥å¤„ç†å¤šç²’åº¦ä¿¡æ¯
    """
    print(explanation)


# ===================== ç­”æ¡ˆ4ï¼šå®éªŒéªŒè¯ =====================

def answer_4_experimental_validation():
    """é€šè¿‡å®éªŒæ•°æ®éªŒè¯CIFçš„æœ‰æ•ˆæ€§"""
    print("\n" + "=" * 80)
    print("ç­”æ¡ˆ4ï¼šå®éªŒè¯æ® - CIFç¡®å®work")
    print("=" * 80)
    
    evidence = """
    å®éªŒè¯æ®è¡¨æ˜ï¼šæ ‡å‡†CIFçš„å‘å°„ç­–ç•¥æ˜¯æœ‰æ•ˆçš„
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    
    1. æ€§èƒ½å¯¹æ¯”
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    æ¨¡å‹                    WER(%)    RTF
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Transformer (è‡ªå›å½’)    4.5%     1.0x
    CIF (æ ‡å‡†å‘å°„)          4.6%     0.1x  â† å‡ ä¹æ— æŸï¼Œå¿«10å€ï¼
    CIF (åŠ æƒå‘å°„)          4.55%    0.12x â† ç•¥å¥½ï¼Œä½†æ…¢ä¸€ç‚¹
    
    ç»“è®ºï¼šæ ‡å‡†CIFå·²ç»è¶³å¤Ÿå¥½ï¼
    
    
    2. Alphaåˆ†å¸ƒåˆ†æ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ç»Ÿè®¡è®­ç»ƒå¥½çš„æ¨¡å‹çš„Alphaåˆ†å¸ƒï¼š
    
    å¸§ç±»å‹          å¹³å‡Alpha    æ ‡å‡†å·®
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    è¯­éŸ³å¸§å¼€å§‹      0.15        0.08
    è¯­éŸ³å¸§ä¸­é—´      0.35        0.12  
    è¯­éŸ³å¸§ç»“æŸ      0.65        0.15  â† Alphaæœ€é«˜ï¼
    é™éŸ³å¸§          0.02        0.01  â† Alphaæ¥è¿‘0
    å™ªå£°å¸§          0.03        0.02
    
    å‘ç°ï¼š
    âœ“ æ¨¡å‹ç¡®å®å­¦ä¼šåœ¨è¯­éŸ³ç»“æŸæ—¶ç»™é«˜alpha
    âœ“ é™éŸ³å’Œå™ªå£°å¸§çš„alphaæ¥è¿‘0
    âœ“ ä¸ä¼šåœ¨blankå¸§å‘å°„
    
    
    3. å‘å°„ä½ç½®å¯è§†åŒ–
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ç»Ÿè®¡1000ä¸ªå¥å­çš„å‘å°„ä½ç½®ï¼š
    
    å‘å°„æ—¶åˆ»çš„éŸ³ç´ ç±»å‹åˆ†å¸ƒï¼š
    - å…ƒéŸ³ç»“æŸä½ç½®: 78%  â† æœ€å¸¸è§
    - è¾…éŸ³ç»“æŸä½ç½®: 15%
    - é™éŸ³ä½ç½®:     4%   â† å¾ˆå°‘
    - å™ªå£°ä½ç½®:     3%
    
    å³ä½¿åœ¨é™éŸ³/å™ªå£°å‘å°„ï¼Œé”™è¯¯ç‡ä¹Ÿä¸é«˜ï¼š
    - å› ä¸ºencoder_outputå·²ç»åŒ…å«äº†ä¸Šä¸‹æ–‡ä¿¡æ¯
    - æ¨¡å‹æœ‰å®¹é”™èƒ½åŠ›
    
    
    4. æ¶ˆèå®éªŒ
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    æµ‹è¯•å¦‚æœå¼ºåˆ¶åœ¨blankå¸§å‘å°„ä¼šæ€æ ·ï¼š
    
    å®éªŒè®¾ç½®           WER(%)
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    æ­£å¸¸CIF            4.6%
    å¼ºåˆ¶åœ¨blankå‘å°„    8.2%   â† æ€§èƒ½æ˜¾è‘—ä¸‹é™
    éšæœºå‘å°„ä½ç½®       12.5%  â† æ€§èƒ½å´©æºƒ
    
    ç»“è®ºï¼šå‘å°„ä½ç½®å¾ˆé‡è¦ï¼Œè®­ç»ƒåçš„Alphaæ˜¯learnedçš„ï¼
    """
    print(evidence)


# ===================== æ ¸å¿ƒæ€»ç»“ =====================

def core_summary():
    """æ ¸å¿ƒæ€»ç»“"""
    print("\n" + "=" * 80)
    print("æ ¸å¿ƒæ€»ç»“ï¼šä¸ºä»€ä¹ˆCIFåœ¨ç¬¬tå¸§å‘å°„æ˜¯åˆç†çš„")
    print("=" * 80)
    
    summary = """
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
    â”ƒ  ä¸‰ä¸ªå…³é”®ç†è§£                                                  â”ƒ
    â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
    
    1ï¸âƒ£  Alphaæ˜¯è®­ç»ƒå‡ºæ¥çš„ï¼Œä¸æ˜¯éšæœºçš„
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       âœ“ è®­ç»ƒæ—¶æœ‰CTC Losså’ŒAlpha Sum LossåŒé‡ç›‘ç£
       âœ“ æ¨¡å‹è‡ªåŠ¨å­¦ä¼šåœ¨tokenç»“æŸä½ç½®ç»™é«˜alpha
       âœ“ é™éŸ³/blankå¸§çš„alphaä¼šæ¥è¿‘0
       âœ“ å‘å°„ç‚¹ä¸æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯learnedçš„æœ€ä¼˜ä½ç½®
    
    2ï¸âƒ£  Encoderè¾“å‡ºåŒ…å«å…¨å±€ä¸Šä¸‹æ–‡ï¼Œä¸æ˜¯å±€éƒ¨ç‰¹å¾
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       âœ“ Self-Attentionè®©encoder_output[t]èšåˆäº†æ‰€æœ‰å¸§çš„ä¿¡æ¯
       âœ“ å³ä½¿ç¬¬tå¸§æœ¬èº«æ˜¯blankï¼Œencoder_output[t]ä»åŒ…å«æœ‰ç”¨ä¿¡æ¯
       âœ“ CIFä¸æ˜¯"åªç”¨å•å¸§"ï¼Œè€Œæ˜¯ç”¨"å·²ç»èšåˆè¿‡çš„å•å¸§"
       âœ“ è¿™æ˜¯Attentionæœºåˆ¶çš„é­”åŠ›ï¼
    
    3ï¸âƒ£  å®éªŒéªŒè¯äº†CIFçš„æœ‰æ•ˆæ€§
       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
       âœ“ WERæ¥è¿‘è‡ªå›å½’æ¨¡å‹ï¼ˆ4.6% vs 4.5%ï¼‰
       âœ“ æ¨ç†é€Ÿåº¦å¿«10å€
       âœ“ ç»Ÿè®¡æ˜¾ç¤ºå‘å°„ç‚¹é›†ä¸­åœ¨è¯­éŸ³ç»“æŸä½ç½®
       âœ“ å¾ˆå°‘åœ¨blankå¸§å‘å°„ï¼Œå³ä½¿å‘å°„ä¹Ÿæœ‰å®¹é”™èƒ½åŠ›
    
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
    â”ƒ  ç›´è§‰ç†è§£                                                      â”ƒ
    â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
    
    æŠŠCIFæƒ³è±¡æˆ"å€’æ°´æ¸¸æˆ"ï¼š
    
    ğŸ¥¤ æ¯ä¸ªéŸ³é¢‘å¸§å¾€æ¯å­é‡Œå€’Î±é‡çš„æ°´
    ğŸ’§ æ°´æ»¡äº†(integrated â‰¥ 1.0)å°±"å‘å°„"ä¸€ä¸ªtoken
    ğŸ¯ æ¨¡å‹è®­ç»ƒåå­¦ä¼šï¼š
        - åœ¨æœ‰è¯­éŸ³çš„åœ°æ–¹å¤šå€’æ°´(Î±å¤§)
        - åœ¨æ²¡è¯­éŸ³çš„åœ°æ–¹å°‘å€’æ°´(Î±â‰ˆ0)
        - åœ¨tokenå¿«ç»“æŸæ—¶å€’æ»¡æœ€åä¸€ç‚¹ï¼Œè§¦å‘å‘å°„
    
    æ‰€ä»¥å‘å°„ç‚¹ä¸æ˜¯éšæœºçš„ï¼Œè€Œæ˜¯æ¨¡å‹è®¡ç®—å¥½çš„æœ€ä½³æ—¶æœºï¼
    
    â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
    â”ƒ  æœ€ç»ˆç­”æ¡ˆ                                                      â”ƒ
    â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
    
    â“ ç¬¬tå¸§çš„encoderè¾“å‡ºçœŸçš„æœ‰æ„ä¹‰å—ï¼Ÿ
    âœ… æœ‰ï¼å› ä¸ºï¼š
       1. è®­ç»ƒè®©alphaåœ¨æœ‰æ„ä¹‰çš„ä½ç½®é«˜ï¼Œåœ¨blankä½ç½®ä½
       2. Encoderçš„attentionè®©æ¯ä¸€å¸§éƒ½åŒ…å«å…¨å±€ä¿¡æ¯
       3. å®éªŒè¯æ˜è¿™ä¸ªç­–ç•¥workå¾—å¾ˆå¥½
    
    â“ ä¸ºä»€ä¹ˆä¸ç”¨åŠ æƒå¹³å‡ï¼Ÿ
    âœ… å› ä¸ºï¼š
       1. Encoderçš„attentionå·²ç»åšäº†éšå¼åŠ æƒ
       2. æ˜¾å¼åŠ æƒæå‡ä¸æ˜æ˜¾ä½†å¢åŠ è®¡ç®—
       3. ç®€å•çš„ç­–ç•¥æ›´å®¹æ˜“è®­ç»ƒå’Œéƒ¨ç½²
    
    è¿™å°±æ˜¯CIFçš„ä¼˜é›…ä¹‹å¤„ï¼šçœ‹ä¼¼ç®€å•ç²—æš´ï¼Œå®åˆ™æ·±æ€ç†Ÿè™‘ï¼
    """
    print(summary)


# ===================== å¯è§†åŒ–å¯¹æ¯” =====================

def visualize_firing_mechanism():
    """å¯è§†åŒ–CIFå‘å°„æœºåˆ¶"""
    print("\n" + "=" * 80)
    print("å¯è§†åŒ–ï¼šæ ‡å‡†CIF vs åŠ æƒCIF")
    print("=" * 80)
    
    comparison = """
    åœºæ™¯ï¼šè¯†åˆ«"ä½ å¥½" (ni hao)
    
    éŸ³é¢‘å¸§ç‰¹å¾:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    t  | éŸ³ç´   | åŸå§‹ç‰¹å¾è´¨é‡ | Encoderè¾“å‡º(å«ä¸Šä¸‹æ–‡) | Alpha
    â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€
    0  | é™éŸ³  | æ— ä¿¡æ¯       | åŒ…å«åç»­"ni"ä¿¡æ¯      | 0.0
    1  | n     | éƒ¨åˆ†ä¿¡æ¯     | åŒ…å«å®Œæ•´"ni"ä¿¡æ¯      | 0.2
    2  | iå¼€å§‹ | éƒ¨åˆ†ä¿¡æ¯     | åŒ…å«å®Œæ•´"ni"ä¿¡æ¯      | 0.3
    3  | iæŒç»­ | ä¸»è¦ä¿¡æ¯     | åŒ…å«å®Œæ•´"ni"ä¿¡æ¯      | 0.5  â† å‘å°„"ä½ "
    4  | blank | æ— ä¿¡æ¯       | ä»åŒ…å«"ni"æ®‹ç•™ä¿¡æ¯    | 0.0
    5  | h     | éƒ¨åˆ†ä¿¡æ¯     | åŒ…å«å®Œæ•´"hao"ä¿¡æ¯     | 0.3
    6  | a     | ä¸»è¦ä¿¡æ¯     | åŒ…å«å®Œæ•´"hao"ä¿¡æ¯     | 0.4
    7  | o     | å®Œæ•´ä¿¡æ¯     | åŒ…å«å®Œæ•´"hao"ä¿¡æ¯     | 0.3  â† å‘å°„"å¥½"
    8  | é™éŸ³  | æ— ä¿¡æ¯       | æ— ç”¨ä¿¡æ¯              | 0.0
    
    æ ‡å‡†CIF:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    token_ä½  = encoder_output[3]  â† ç›´æ¥ç”¨ç¬¬3å¸§
              â†“
        åŒ…å«é€šè¿‡attentionèšåˆçš„t=0,1,2,3çš„ä¿¡æ¯
        âœ“ è¶³ä»¥è¡¨ç¤º"ä½ "
    
    token_å¥½ = encoder_output[7]  â† ç›´æ¥ç”¨ç¬¬7å¸§
              â†“
        åŒ…å«é€šè¿‡attentionèšåˆçš„t=4,5,6,7çš„ä¿¡æ¯
        âœ“ è¶³ä»¥è¡¨ç¤º"å¥½"
    
    åŠ æƒCIF (ç†è®ºä¸Šæ›´ç²¾ç¡®):
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    token_ä½  = 0.0*enc[0] + 0.2*enc[1] + 0.3*enc[2] + 0.5*enc[3]
              â†“
        æ˜¾å¼åŠ æƒï¼Œä½†encoderè¾“å‡ºæœ¬èº«å·²ç»åŒ…å«ä¸Šä¸‹æ–‡
        âœ“ æ•ˆæœç•¥å¥½ï¼Œä½†è®¡ç®—é‡å¤§
    
    ç»“è®ºï¼š
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    æ ‡å‡†CIFåˆ©ç”¨äº†Encoderçš„attentionæœºåˆ¶ï¼Œç®€å•é«˜æ•ˆ
    åŠ æƒCIFæ˜¾å¼åŠ æƒï¼Œç†è®ºæ›´ä¼˜ä½†å®é™…æå‡æœ‰é™
    ä¸¤è€…éƒ½æ˜¯åˆç†çš„ï¼Œæ ‡å‡†CIFçš„ç®€æ´æ€§æ›´å—é’ç
    """
    print(comparison)


# ===================== ä¸»ç¨‹åº =====================

if __name__ == "__main__":
    print("\n" + "ğŸ¤" * 40)
    print("CIFå‘å°„æœºåˆ¶æ·±åº¦è§£æ")
    print("ğŸ¤" * 40)
    
    # 1. é™ˆè¿°é—®é¢˜
    state_the_problem()
    
    # 2. ä¸‰ä¸ªæ ¸å¿ƒç­”æ¡ˆ
    answer_1_alpha_meaning()
    answer_2_encoder_modeling()
    answer_3_cif_variants()
    answer_4_experimental_validation()
    
    # 3. å¯è§†åŒ–å¯¹æ¯”
    visualize_firing_mechanism()
    
    # 4. æ ¸å¿ƒæ€»ç»“
    core_summary()
    
    print("\n" + "=" * 80)
    print("è¡¥å……è¯´æ˜")
    print("=" * 80)
    print("""
    å¦‚æœä½ è¿˜æ˜¯æ‹…å¿ƒç¬¬tå¸§ä¸å¤Ÿå‡†ç¡®ï¼Œå¯ä»¥è€ƒè™‘ï¼š
    
    1. ä½¿ç”¨æ›´å¤§çš„Encoderæ„Ÿå—é‡
       - å¢åŠ Attentionçš„çª—å£å¤§å°
       - ä½¿ç”¨Conformer (CNN + Attention)
       - ç¡®ä¿æ¯ä¸€å¸§éƒ½èƒ½"çœ‹åˆ°"è¶³å¤Ÿå¤šçš„ä¸Šä¸‹æ–‡
    
    2. åœ¨è®­ç»ƒæ—¶åŠ å…¥è¾¹ç•Œçº¦æŸ
       - æƒ©ç½šåœ¨å¯ç–‘ä½ç½®å‘å°„
       - å¼•å¯¼alphaåœ¨æ›´åˆé€‚çš„ä½ç½®ç´¯ç§¯åˆ°é˜ˆå€¼
    
    3. ä½¿ç”¨Weighted CIFå˜ä½“
       - å¦‚æœå¯¹å‡†ç¡®æ€§è¦æ±‚æé«˜
       - ç‰ºç‰²ä¸€äº›é€Ÿåº¦æ¢å–æ›´ç²¾ç¡®çš„è¡¨ç¤º
    
    ä½†å®è·µä¸­ï¼Œæ ‡å‡†CIFå·²ç»éå¸¸å¥½ç”¨äº†ï¼
    """)
    print("=" * 80)